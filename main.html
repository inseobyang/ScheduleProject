<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <title>My BCIT Project</title>
    <meta name="comp1930 boilerplate code" content="my bcit project">
    <meta name="author" content="BCIT">

    <!------------------------------------------------------------------------------>
    <!-- Bootstrap for Mobile-first                                               -->
    <!------------------------------------------------------------------------------>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>  
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
  
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />

  <script>
    var firebaseConfig = {
      apiKey: "AIzaSyD2QaXTqDNi9hBP5gMK9z_19YVKoBU9NeM",
      authDomain: "comp1930-schedule-project.firebaseapp.com",
      databaseURL: "https://comp1930-schedule-project.firebaseio.com",
      projectId: "comp1930-schedule-project",
      storageBucket: "comp1930-schedule-project.appspot.com",
      messagingSenderId: "610999211117",
      appId: "1:610999211117:web:c490ce02c2b24418b09b64"
    };

    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore(); //should be const?
  </script>
</head>

<body>
  <h1> Hello CST its Thursday </h1>
  <h1> Welcome to John's App </h1>
  <h2> let's read from the database: <span id="stuff"> stuff </span> </h2>
  
  <script>
  function createCourse() {
    var coursesRef = db.collection("Users").doc("Courses").collection("Current Courses");
    coursesRef.doc("Course 2").set({
      code: "COMP 1", building: "SW05", room: "1850",
      number: "1712"
    });
  }
  </script>
  
  <script>
    //if script is kept in a function, a main benefit is that we can control the order in which functions are called
    function createCities() {
      var citiesRef = db.collection("cities2");
    //.set = if it did not exist before, create it
    citiesRef.doc("DD").set({
        name: "DanDrancisco", state: "CA", country: "USA",
        capital: false, population: 860000,
        regions: ["west_coast", "norcal"] });
      console.log("HEY");
    citiesRef.doc("LA").set({
        name: "LosAngeles", state: "CA", country: "USA",
        capital: false, population: 3900000,
        regions: ["west_coast", "socal"] });
    citiesRef.doc("DC").set({
        name: "Washington", state: null, country: "USA",
        capital: true, population: 680000,
        regions: ["east_coast"] });
    citiesRef.doc("TOK").set({
        name: "Tokyo", state: null, country: "Japan",
        capital: true, population: 9000000,
        regions: ["kanto", "honshu"] });
    citiesRef.doc("BJ").set({
        name: "Beijing", state: null, country: "China",
        capital: true, population: 21500000,
        regions: ["jingjinji", "hebei"] });
    citiesRef.doc("BBY").set({
        name: "Burnaby", state: null, country: "Canada",
        capital: false, population: 21500000,
        regions: ["west_coast", "gva"] });
    citiesRef.doc("VAN").set({
        name: "Vancouver", state: null, country: "Canada",
        capital: false, population: 20000000,
        regions: ["west_coast", "gva"] });
    citiesRef.doc("SEO").set({
        name: "Seoul", state: null, country: "South Korea",
        capital: false, population: 20000000,
        regions: ["Korea"] });
      };
  </script>
  
  <!-- ********************************* FIRST PART OF TUTORIAL ******************************** -->
  <script>
  function displayCities() {
    //get is asynchronous, we want it to be done before display
    //.then is call back function
    //.add adds new document for you
    //.set/.updates says it is going to add new fields to existing document; else, makes new document
    //on document, you can get or onSnapshot
    //onSnapshot for real-time changes
    //onSnapshot doesn't need then because it will only occur when database is updated
    
    db.collection("cities2").get().then(function(snap) {
      console.log(snap)
      snap.forEach(function(doc) {
        console.log(doc.data().name)
        var name = doc.data().name;
        
        //appends city name to dynamically created element
        var para = document.createElement("div"); //create div
        
        document.body.appendChild(para); //append div to end of body
        
        var node = document.createTextNode(name); //from firestore
        para.appendChild(node); //append new node containing name to div
        para.setAttribute("id", name);
        //cant create an ID with spaces
        
        $("#" + name).click(function() {
          alert(name + " handler clicked");
        })
        
      });
    });
  }
  </script>
  
  <script>
    createCourse();
    createCities();
    displayCities();
  </script>
  
  <script>
  //api all to firebase database, finds reference into a bit of data, gets data, and sticks into DOM and display it
  //onSnapshot is also listener; will update when data is updated
  //handler goes in round brackets
  db.collection("Users").doc("Courses").collection("Current Courses").doc("Course 1").onSnapshot(function(snap){
    console.log("current data is ...", snap.data());
    document.getElementById("stuff").innerHTML= snap.data().CourseBuilding;
  });
  
  //first part of script is createUser();
  //showName();
    
  //all scripts are in scripts folder, holding js
    // read .get() or .onSnapshot()
    // writing .set() or .update() or .add()
  </script>
  
  
</body>

</html>