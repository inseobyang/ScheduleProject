<!DOCTYPE html>
<html>
  <head>
    <link href='https://fonts.googleapis.com/css?family=Oxygen' rel='stylesheet'>
    <title> Home page </title>
    <meta charset="utf-8"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    
    <!------------------------------------------------------------------------------>
    <!-- Bootstrap for Mobile-first                                               -->
    <!------------------------------------------------------------------------------>
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />

    <!------------------------ Link to firebase ------------------------------------------------------>
  <script>
    var firebaseConfig = {
      apiKey: "AIzaSyD2QaXTqDNi9hBP5gMK9z_19YVKoBU9NeM",
      authDomain: "comp1930-schedule-project.firebaseapp.com",
      databaseURL: "https://comp1930-schedule-project.firebaseio.com",
      projectId: "comp1930-schedule-project",
      storageBucket: "comp1930-schedule-project.appspot.com",
      messagingSenderId: "610999211117",
      appId: "1:610999211117:web:c490ce02c2b24418b09b64"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    </script>
    
    <!----------------------------- Styling ---------------------------------------------------------------->
    <style>
      
      html, body {
        margin: 0;
        padding: 0;
        font-family: "Oxygen";
      }
      
      #course-form {
        margin-left: 10px;
      }
      
      .grid-container .nav {
        grid-area: nav;
        border-bottom: 1px solid darkblue;
        display: inline-grid;
        grid-template-columns: 1fr 4fr 1fr 1fr 1fr;
        grid-template-areas: 
          "logo search home profile options";
        background-color: white;
        color: #071350;
        text-align: center;
      }
      #logo {
        width: 48px;
        height: 48px;        
      }
      .logo { 
        grid-area: logo;
      }
      .search {
        grid-area: search;
      }
      .home {
        grid-area: home;
      }
      .profile {
        grid-area: profile;
      }
      .options {
        grid-area: options;
      }
      .grid-container .header {
        grid-area: header;
        background-color: white;
        color: black;
        font-size: 18pt;
        padding-left: 20px;
        letter-spacing: 1px;
        text-align: center;
      }
      .grid-container .schedule {
        grid-area: schedule;
        margin-left: 25px;
        margin-right: 25px;
        box-shadow: 0px 0px 10px 0px inset black;
        background-color: #f2f2f2;
        text-align: center;
        text-align: left;
      }
      .grid-container .footer {
        grid-area: footer;
        text-align: center;
        background-color: white;
      }
      
      .grid-container {
        display:inline-grid;
        vertical-align: middle;
        margin-top: 30px;
        height: 100vh;
        border-left: 1px solid darkblue;
        border-right: 1px solid darkblue;
        width: 100%;
        grid-template-columns: 1fr;
        grid-template-rows: 5% 10% 75% 10%;
        grid-template-areas:
          "nav"
          "header"
          "schedule"
          "footer"
      }
      
    </style>
  </head>
  
  <body>
    <div class="grid-container">    
      <div class="nav">
        <div class="logo"><img id="logo" src="ScheduleLogo.svg"></div>
        <div class="search"><p> | Home | </p></div>
        <div class="home"><p> | Profile | </p></div>
        <div class="profile"><p> | Connections | </p></div>
        <div class="options"><p> | Options | </p></div>
      </div>
      
      <div class="header">
      </div>
      
      <div class="schedule">
        <ul id="myCourseList"></ul>
        <form id="course-form">
          <input type="text" name="newCode" placeholder="Course code..."><br>
          <input type="text" name="newNumber" placeholder="Course number..."><br>
          <input type="text" name="newType" placeholder="Course type..."><br>
          <input type="text" name="newBuilding" placeholder="Course building..."><br>
          <input type="text" name="newRoom" placeholder="Course room..."><br>
          <button> Add course to schedule </button>
        </form>
      </div>

      <div class="footer">
      </div>
      
    </div>
    
    <script>
      const form = document.querySelector('#course-form');
      
      const courseList = document.querySelector('#myCourseList');
      
      function renderCourses(doc) {
        let li = document.createElement('li');
        let code = document.createElement('span');
        let number = document.createElement('span');
        let courseType = document.createElement('span');
        let building = document.createElement('span');
        let room = document.createElement('span');
        let closeButton = document.createElement('span');
        
        li.setAttribute('data-id', doc.id);
        code.textContent = doc.data().courseCode + " ";
        number.textContent = doc.data().courseNumber + " ";
        courseType.textContent = doc.data().courseType + " ";
        building.textContent = doc.data().building + " ";
        room.textContent = doc.data().roomNumber + " ";
        closeButton.textContent = "[X]";
        
        li.appendChild(code);
        li.appendChild(number);
        li.appendChild(courseType);
        li.appendChild(building);
        li.appendChild(room);
        li.appendChild(closeButton);
        
        courseList.appendChild(li);
        
        //remove data
        //grabs unique document id by going from closeButton -> li -> li attribute which is doc id
        closeButton.addEventListener('click', (e) => {
          e.stopPropagation;
          let id = e.target.parentElement.getAttribute('data-id');
          db.collection("newCourses").doc(id).delete();
        });
      }
      
      //get data
      /*db.collection("newCourses").get().then((snapshot) => {
        console.log(snapshot.docs.forEach(doc => {
          renderCourses(doc);
        }));
      })*/
      
      
      //listening
      db.collection("newCourses").onSnapshot(snapshot => {
        let changes = snapshot.docChanges(); //assign all changes to variable changes
        changes.forEach(change => {
          if(change.type == 'added') {
            renderCourses(change.doc);
          } else if (change.type == 'removed') {
            let li = courseList.querySelector('[data-id=' + change.doc.id + ']');
            courseList.removeChild(li);
          }
        })
      })
      
      //COLOR LABS HOT PINK -- rework later because I don't think this part applies yet; going to try function instead first
      
      /*db.collection("newCourses").where('courseType', '==', 'LAB').get().then((snapshot) => {
        snapshot.docs.forEach(doc)
      });*/
      
      
      //submit data
      form.addEventListener('submit', (e) => {
        //need to prevent default button
        e.preventDefault();
        db.collection('newCourses').add({
          courseCode: form.newCode.value,
          courseNumber: form.newNumber.value,
          courseType: form.newType.value,
          building: form.newBuilding.value,
          roomNumber: form.newRoom.value
        });
        form.newCode.value = '';
        form.newNumber.value = '';
        form.newType.value = '';
        form.newBuilding.value = '';
        form.newRoom.value = '';
      })
    </script>
    <!-------------------------------------------------------- JUST NOTES
    <script>
      //api all to firebase database, finds reference into a bit of data, gets data, and sticks into DOM and display it
      //onSnapshot is also listener; will update when data is updated
      //handler goes in round brackets
      db.collection("Users").doc("Courses").collection("Current Courses").doc("Course 1").onSnapshot(function(snap){
        console.log("current data is ...", snap.data());
        document.getElementById("stuff").innerHTML= snap.data().CourseBuilding;
      });
      db.collection("Users").doc("userInformation").onSnapshot(function(snap){
        console.log("current data is ...", snap.data());
        document.getElementById("john").innerHTML= snap.data().lastName;
      });

      //first part of script is createUser();
      //showName();

      //all scripts are in scripts folder, holding js
    </script> -->
    
    <script>
    // read .get() or .onSnapshot()
    // writing .set() or .update() or .add()
      $("#practiceSubmit").click(function() {
        db.collection("Users").doc("Courses").collection("Current Courses").doc("Course 1").set({
          CourseBuilding: "SE12"
        })
      });
      
      $("#practiceSubmit").click(function() {
        db.collection("Users").doc("Courses").set({
          CourseBuilding: "SE12",
          courseCode: "1712",
          courseName: "COMP"
        })
      });
    </script>
  
  <script>
      $(document).ready(function() {
        var firstName = "John";
        var lastName = "Yang";
        $(".header").append("<p>" + firstName + " " + lastName + "'s Class Schedule: </p>");
      });
  </script>
    
  <script>
      $(document).ready(function() {
        var d = new Date();
        yr = d.getFullYear();
        month = d.getMonth()+1;
        if (month == 1) {
          month = "January";
        }
        else if (month == 2) {
          month = "February";
        }
        else if (month == 3) {
          month = "March";
        }
        else if (month == 4) {
          month = "April";
        }
        else if (month == 5) {
          month = "May";
        }
        else if (month == 6) {
          month = "June";
        }
        else if (month == 7) {
          month = "July";
        }
        else if (month == 8) {
          month = "August";
        }
        else if (month == 9) {
          month = "September";
        }
        else if (month == 10) {
          month = "October";
        }
        else if (month == 11) {
          month = "November";
        }
        else if (month == 12) {
          month = "December";
        }
        day = d.getDate();
        var dateToday = "<p id='date'> Week of " + month + " " + day + ", " + yr + "</p>";
        $(".header").append(dateToday);
        
          $("#logo").click(function(){
            if (day + 7 < 31) {
              day = day + 7;
              $('#date').remove();
              dateToday = "<p id='date'> Week of " + month + " " + day + ", " + yr + "</p>";
              $(".header").append(dateToday);
            }
            else {
              month = "December";
              day = day - 30 + 7;
              $('#date').remove();
              dateToday = "<p id='date'> Week of " + month + " " + day + ", " + yr + "</p>";
              $(".header").append(dateToday);
            }
          });
        });
    </script>
    
  </body>
</html>